---
title: "Salaries in tech industry"
author: "Emanuele Lena - 142411@uniud"
date: "27/11/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ---------------------------------------
# Preliminary operations

## **************************************
## Useful libs

```{r}
library(lubridate)
library(tidyverse)
```

## **************************************
## Load data 

```{r}
salaries <- read.csv("Levels_Fyi_Salary_Data.csv")
head(salaries, 50) 
```


# --------------------------------------------------
# Preliminary analysis

Here I start with a preliminary analysis of datasets, his variables and his strucuture

## **************************************
## Dataset overview

### Dataset size

Number of observations:

```{r}
nrow(salaries)
```

### Overview of all variables

Here all variables names:
```{r}
colnames(salaries)
```

#### Results

* I notice two type of variables: the ones related to "what the employee gets" and all others;
* variables related to what employer gets are: 

"abasesalary", "totalyearlycompensation", "bonus", "stockgrantvalue";

* the other variables include informations like:

** company
** job position
** physical location
** employee experience in company
** education
** gender
** race

* each row is also associated to a timestamp (the source date of the data?).


## **************************************
## Timestamps overview

As we seen in precedent step, this dataset contains observation spread over time. Before starting my real analysis I wanna deepening deepen (a bit) the "timestamp" variable.

### Timestamp format

#### NA check

Count number of (eventual) missing values:

```{r}
sum(is.na(salaries$timestamp))
```

```{r}
sum(salaries$timestamp == "NA")
```


#### Timestamp format check

Let's check the format to be able to operate on it: 

```{r}
salaries$timestamp[1]
```

#### Adjust timestamp format

To ensure operability, we prefer something like this:

```{r}
mdy_hms(salaries$timestamp[4])
```

Let's create a new dataset where I use my new format 

```{r}
salaries2 <- salaries

# override timestamp using my new format
salaries2$timestamp <- mdy_hms(salaries$timestamp)

# I suppose I will not need the full datetime, so I parse just the date (and add as new col)
salaries2$date <- substr(salaries2$timestamp, 0, 10)

salaries2$date[1]
```

### Overview on timestamp range and distribution

To know how to operate, first of all I wanna know the time distib. of my data

#### Date range

```{r}
min(salaries2$date)
max(salaries2$date)
```

#### Timestamps quantiles
```{r}
quantile(salaries2$timestamp, 0.25)
quantile(salaries2$timestamp, 0.5)
quantile(salaries2$timestamp, 0.75)
```

#### Timestamps distribution

```{r}

hist(as.Date(salaries2$timestamp), breaks = "quarters")

```

#### Results

* my data are all included between 2017 and 2021 (nearbly the second quarter)
* most of my data (more than 75%) belongs to years 2020 and 2021
* for a first analysis, we will ignore the time factor

## **************************************
## Interest variables overview

Now I start a prover overview of the interest variables (seen in isolation). This analysis has the purpose to analyze (in isolation) their charateristics

### Variables meaning

First of all, I wanna undestand the meaning of each variable. 

Let's print some observation and try to understand their meaning.

```{r}
salaries2 %>% select(basesalary, totalyearlycompensation, bonus, stockgrantvalue) %>% head(20)
```


#### Results

* the main variable here, it's <code>totalyearlycompensation</code>. It rappresent the total amount of money an employee recevies in a year. It will be mine main focus for the next analysis.

* three other intresting vars are <code>basesalary, bonus, stockgrantvalue</code>. I immediatly notice all there, contrary to <code>totalyearlycompensation</code>, can be =0.

* according to Google, <code>totalyearlycompensation</code> should be the total amount of pay an employee (so the sum of all forms of payment). Some times <code>totalyearlycompensation</code> seems the sum of all the specific payment vars, some times it seems the sum of just some of them, other times seems totally unrelated. We will suppose data have not been collected in a unique way, so at the beginning we will consieder them separate.

### An overview on total yearly compensation

Let's focus on <code>totalyearlycompensation</code>. 

To begin, let's rename it to use it more easly:
```{r}
salaries3 <- salaries2 %>% rename(tyc=totalyearlycompensation)
```

#### Overview statistics

Mean and median:
```{r}
mean(salaries3$tyc)
median(salaries3$tyc)
```

Quantiles: 
```{r}
quantile(salaries3$tyc, 0.25)
quantile(salaries3$tyc, 0.50)
quantile(salaries3$tyc, 0.75)
```

Variance:
```{r}
var(salaries3$tyc)
```

Min and max
```{r}
min(salaries3$tyc)
max(salaries3$tyc)

```


#### Density curve and histograms

Fist of all, I wanna have a generic overview of the total year compensation histogram, setting a class break each 50k.

```{r}
# par(mfrow=c(1,2))
hist(salaries3$tyc, breaks=seq(0, 5000000, by=50000), 
     xlab = "Salary [USD]", main="Salaries distribution")
hist(salaries3$tyc, breaks=seq(0, 5000000, by=50000), freq = F, 
     xlab = "Salary [USD]", main="Salaries distribution (relative f)")
# par(mfrow=c(1,1))

```

I notice immediatly most of my observations concentrate on the 3-5th classes. I notice also (as confirmed from the mean fairly > to median) my right curves are fairly heavier than my left ones. 

To understand more what's happening, let's produce a more detailed view on quantiles.

#### Quantiles

Quantiles on boxplot:
```{r}
boxplot(salaries3$tyc, horizontal=TRUE) 
```


#### Results

According to what I see in 









